# 待办任务


困难
⭐
![[../../img/Pasted image 20231030095750.png]]
在生命周期里面执行了改变state的数据，导致的错误。
# 今日任务
subform的删除步骤
1. 先保存当前的数据到store中
2. 找到rowKey的值把ref删除掉
3. 在把对应的rowId删除掉
4. 再去执行删除store的操作

> 出现问题，就是store值更改了但是实际的sub-form页面的组件还是旧的值。可以看看新的originData是不是正确的数据。

> 问题原因是父组件的props改变了但是setState才会触发子组件的改变。且在生命周期的componentWillUpdata中要手动的判断当前的props的数据是否改变。并重新赋值。
> 注意：
> 如果不加条件的话就会出现上面的错误，超出最大的无限次地触发状态更新或导致重新渲染。循环更新而导致的错误。

~~~js
    componentDidUpdate(preProps, preState) {
        const {propName} = preProps;
        if (preProps.defaultValue != this.props.defaultValue) {
            this.setState({
                [propName]: this.props.defaultValue
            })
        }
    }
~~~


# 最后的容器和字段的存储值问题
最初想法，在每个容器中添加更改全局的formData的方法。
因为现在的formData是完全匹配web端的formData理念，通过formItemFlag这个参数来递归得到值。
但是会因为subform导致所有的组件都要添加这个方法。不知道是否合理。
而且容器的js代码后续的扩展性都很差。还有设置disable和必填项这种需求。




------
# 本周任务列表



# 悟

react的重新render 构造函数还执行吗？

1. react中，state,props,context三兄弟改变时，都会引起render重绘，但是重绘并不会导致**构造器 constructor**重新执行。

2. 父组件套子组件时，当父组件的render重绘，子组件构造器不执行

所以当父组件的props改变了，类组件就需要用componentWillUpdate的生命周期来接收之前的props和之前的state。